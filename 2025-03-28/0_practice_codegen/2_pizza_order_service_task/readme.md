# Кодогенерация сервера с помощью oapi-codegen

## Установите кодогенератор
```shell
go install github.com/oapi-codegen/oapi-codegen/v2/cmd/oapi-codegen@latest
```

## Запустите генерацию кода для всех go файлов в текущей папке и всех подпапках 
(в этот раз используем Makefile для удобства)
```shell
make gen_api
```

## Убедитесь, что создался файл в папке `internal/web/api` `api.go`
```shell
ls -la internal/web/api | grep api.go
```

## Запустим наш сервер, но в начале пробросим переменные окружения
```shell
export HOST=localhost
export PORT=8080     
export LOGGER_LEVEL=D

go run ./cmd/server/main.go 
```

## В отдельном терминале можем протестировать запросы
### Проверка валидации параметров запроса
С правильными параметрами
```shell
curl "http://localhost:8080/orders?status=pending" 
```

С ошибкой в параметрах
```shell
curl "http://localhost:8080/orders?status=pendin" 
```

# Задание на кодогенерацию
Наша пиццерия расширяется, раньше мы принимали заказы только по телефону.
Но теперь сможем принимать из интернета!

В папке задания лежит новая версия спецификации - в ней добавился метод `POST` для `/orders`.

Ваша задача
- Сгенерировать код `api`
- Написать функцию обработчик, который создает заказ (можно просто мок данные вернуть)

Домашнее задание (если не успеем на паре сделать)
- \*Написать слой сервиса (и желательно репозитория) с хранением in memory заказов.
  - Слой сервиса (и репозитория реализуйте с использованием интерфейсов).
Это мы пройдем на лекции (но по идее вы уже видели как создавать репозиторий,
а слой сервисов с похожим принципом создается).

  - `POST` создание заказа и хранение его в памяти.
  - `GET` получение заказов из памяти.
  - Если реализуйте фильтр по параметру `status` (для `GET` запроса).

## Как протестировать
В идеале - написать тесты на запросы.
Но так как время ограниченно - протестируем через `curl`.
- `POST` orders валидный
```shell
curl -X POST "http://localhost:8080/orders" \
-H "Content-Type: application/json" \
-d '{
  "pizzas": [
    {
      "name": "Пепперони",
      "size": "medium",
      "quantity": 2
    }
  ],
  "delivery_address": "пгт Сириус, ул. Международная, д.2/1",
  "phone": "+79991234567"
}' | jq
```

```shell
curl -X POST "http://localhost:8080/orders" \
-H "Content-Type: application/json" \
-d '{
  "pizzas": [
    {
      "name": "Маргарита",
      "size": "small",
      "quantity": 1
    },
    {
      "name": "Пепперони",
      "size": "medium",
      "quantity": 1
    }
  ],
  "delivery_address": "пгт Сириус, ул. Международная, д.1",
  "phone": "+79997654321"
}' | jq
```

- `GET` orders
```shell
curl "http://localhost:8080/orders?status=pending" | jq
```

